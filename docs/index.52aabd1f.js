!function(){const t=t=>t.dataset.startAt||0;const e=document.getElementById("play-btn");e.classList.add("disabled");var n={unmount:function(){},mount:function(n){console.log("play button mount");const o=()=>{e.classList.remove("disabled")},s=()=>{n.duration>0&&!n.paused?(n.pause(),n.currentTime=t(n)):n.play()},i=()=>{e.classList.toggle("active")};n.addEventListener("canplaythrough",o),["play","pause"].forEach((t=>n.addEventListener(t,i))),e.addEventListener("click",s),this.unmount=()=>{console.log("play button unmount"),e.classList.add("disabled"),e.removeEventListener("click",s),n.removeEventListener("canplaythrough",o),["play","pause"].forEach((t=>n.removeEventListener(t,i)))}}};const o=document.getElementById("stop-btn");o.classList.add("disabled");var s={unmount:function(){},mount:function(e){console.log("stop button mount"),o.classList.remove("disabled");const n=()=>{e.pause(),e.currentTime=t(e)};o.addEventListener("click",n),this.unmount=()=>{console.log("stop button unmount"),o.removeEventListener("click",n),o.classList.add("disabled")}}};const i=document.getElementById("pause-btn");i.classList.add("disabled");var a={unmount:function(){},mount:function(t){console.log("pause button mount"),i.classList.remove("disabled");const e=()=>{t.duration>0&&!t.paused&&(t.pause(),i.classList.add("active"))},n=()=>{i.classList.remove("active")};t.addEventListener("play",n),i.addEventListener("click",e),this.unmount=()=>{console.log("pause button unmount"),i.removeEventListener("click",e),t.removeEventListener("play",n),i.classList.add("disabled")}}};document.getElementById("time");const r="00:00.000",l=time.querySelector(".time-current"),c=time.querySelector(".time-total--value");l.innerHTML=r,c.innerHTML=r;const u=t=>t>=10?t:"0"+t,d=t=>{let e=new Date(1e3*t);var n;return(u(e.getMinutes())+":"+u(e.getSeconds())+"."+((n=e.getMilliseconds())>=100?n:"0"+u(n))).split("").map((t=>0===t.localeCompare(".")||0===t.localeCompare(":")?t:'<span class="letter">'+t+"</span>")).join("")};var h={unmount:function(){},mount:function(t){console.log("time component mount");const e=()=>{c.innerHTML=d(t.duration),l.innerHTML=d(t.currentTime)};t.addEventListener("durationchange",e);var n=null;const o=()=>{n&&(clearInterval(n),n=null)},s=()=>{o()},i=e=>{o(),n=setInterval((()=>{l.innerHTML=d(t.currentTime)}),100*audio.playbackRate)};["play","ratechange"].forEach((t=>{audio.addEventListener(t,i)})),t.addEventListener("pause",s),this.unmount=()=>{console.log("time component unmount"),o();try{audio.removeEventListener("durationchange",e),audio.removeEventListener("pause",s).ratechange.forEach((e=>{t&&audio.removeEventListener(e,i)}))}catch(t){console.warn(t)}l.innerHTML=r,c.innerHTML=r}}};const m=document.getElementById("speed");m.classList.add("disabled");const f=m.querySelector(".speed-range"),g=f.querySelector(".speed-range--dot"),p=f.querySelector(".speed-range--progress"),v=m.querySelector(".speed-range--value"),y=p.clientWidth,_=f.offsetLeft+g.clientWidth,x=f.offsetLeft+f.clientWidth-g.clientWidth/2,L=t=>v.innerHTML=t.toFixed(1).split("").map((t=>0===t.localeCompare(".")?t:'<span class="letter">'+t+"</span>")).join(""),E=t=>{p.style.setProperty("--value",t+"%")};function b(t){g.style.left=t+"px";const e=100*t/y;E(e),w.onchange&&w.onchange(e)}!function(t){var e=0,n=0,o=0;function s(s){return(s=s||window.event).preventDefault(),e=n-s.clientX,o-s.clientY,n=s.clientX,o=s.clientY,s.clientX<_?(b(0),!0):s.clientX>x?(b(f.clientWidth-g.clientWidth),!0):void b(t.offsetLeft-e)}function i(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=function(t){(t=t||window.event).preventDefault(),n=t.clientX,o=t.clientY,document.onmouseup=i,document.onmousemove=s}}(g);const w={unmount:function(){},onchange:void 0,mount:function(t){console.log("speed ragne mount"),m.classList.remove("disabled"),E(100-t.playbackRate*y),L(t.playbackRate),this.onchange=function(t,e,n){let o;return function(){const s=this,i=arguments,a=function(){o=null,n||t.apply(s,i)},r=n&&!o;clearTimeout(o),o=setTimeout(a,e),r&&t.apply(s,i)}}((e=>{t.playbackRate=Math.max(1-e/100,.25),L(t.playbackRate)}),80),this.unmount=()=>{console.log("speed ragne unmount"),this.onchange=void 0,m.classList.add("disabled")}}};function k(t){this.ctx=t,this.mainColor="black"}k.prototype={__toRadians__:function(t){return t*Math.PI/180},__rotatePoint__:function([t,e],[n,o],s){let i=this.__toRadians__(s);return[Math.cos(i)*(t-n)-Math.sin(i)*(e-o)+n,Math.sin(i)*(t-n)+Math.cos(i)*(e-o)+o]},mutateData:function(t,e,n=null){if("mirror"===e){let e=[];for(let n=0;n<t.length;n+=2)e.push(t[n]);return e=[...e,...e.reverse()],e}if("shrink"===e){n<1&&(n=t.length*n);let e=[],o=Math.floor(t.length/n);for(let s=1;s<=n;s++){let n=t.slice(s*o,s*o+o),i=n[Math.floor(n.length/2)];e.push(i)}return e}if("split"===e){let e=Math.floor(t.length/n),o=[],s=[],i=0;for(let a=0;a<=e*n;a++)i===e&&(o.push(s),s=[],i=0),s.push(t[a]),i++;return o}if("scale"===e){let e=n/255;return n<=3&&n>=0&&(e=n),t.map((t=>t*e))}if("organize"===e){let e={};return e.base=t.slice(60,120),e.vocals=t.slice(120,255),e.mids=t.slice(255,2e3),e}if("reverb"===e){let e=[];return t.forEach(((n,o)=>{e.push(n-(t[o+1]||0))})),e}if("amp"===e){let e=[];return t.forEach((t=>{e.push(t*(n+1))})),e}if("min"===e){let e=[];return t.forEach((t=>{t<n&&(t=n),e.push(t)})),e}},getPoints:function(t,e,[n,o],s,i,a={}){let{offset:r=0,rotate:l=0,customOrigin:c=[]}=a,u={start:[],end:[]};if("circle"===t){let t=360/s,a=this.__toRadians__(t),c=e/2;for(let t=1;t<=s;t++){let e=a*t,s=i[t-1],d=i[t-1]*(r/100),h=n+(c-d)*Math.cos(e),m=o+(c-d)*Math.sin(e),f=this.__rotatePoint__([h,m],[n,o],l);u.start.push(f),h=n+(c-d+s)*Math.cos(e),m=o+(c-d+s)*Math.sin(e);let g=this.__rotatePoint__([h,m],[n,o],l);u.end.push(g)}return u}if("line"===t){let t=e/s;n=c[0]||n,o=c[1]||o;for(let e=0;e<=s;e++){let s=l,a=i[e]*(r/100),c=this.__rotatePoint__([n+e*t,o-a],[n,o],s);u.start.push(c);let d=this.__rotatePoint__([n+e*t,o+i[e]-a],[n,o],s);u.end.push(d)}return u}},drawCircle:function([t,e],n,o={}){let{color:s,lineColor:i=this.ctx.strokeStyle}=o;this.ctx.beginPath(),this.ctx.arc(t,e,n/2,0,2*Math.PI),this.ctx.strokeStyle=i,this.ctx.stroke(),this.ctx.fillStyle=s,s&&this.ctx.fill()},drawOval:function([t,e],n,o,s={}){let{rotation:i=0,color:a,lineColor:r=this.ctx.strokeStyle}=s;i&&(i=this.__toRadians__(i)),this.ctx.beginPath(),this.ctx.ellipse(t,e,o,n,i,0,2*Math.PI),this.ctx.strokeStyle=r,this.ctx.stroke(),this.ctx.fillStyle=a,a&&this.ctx.fill()},drawSquare:function([t,e],n,o={}){this.drawRectangle([t,e],n,n,o)},drawRectangle:function([t,e],n,o,s={}){let{color:i,lineColor:a=this.ctx.strokeStyle,radius:r=0,rotate:l=0}=s;this.ctx.beginPath(),this.ctx.moveTo(t+r,e);let c=this.__rotatePoint__([t+o,e],[t,e],l),u=this.__rotatePoint__([t+o,e+n],[t,e],l);this.ctx.arcTo(c[0],c[1],u[0],u[1],r);let d=this.__rotatePoint__([t+o,e+n],[t,e],l),h=this.__rotatePoint__([t,e+n],[t,e],l);this.ctx.arcTo(d[0],d[1],h[0],h[1],r);let m=this.__rotatePoint__([t,e+n],[t,e],l),f=this.__rotatePoint__([t,e],[t,e],l);this.ctx.arcTo(m[0],m[1],f[0],f[1],r);let g=this.__rotatePoint__([t,e],[t,e],l),p=this.__rotatePoint__([t+o,e],[t,e],l);this.ctx.arcTo(g[0],g[1],p[0],p[1],r),this.ctx.closePath(),this.ctx.strokeStyle=a,this.ctx.stroke(),this.ctx.fillStyle=i,i&&this.ctx.fill()},drawLine:function([t,e],[n,o],s={}){let{lineColor:i=this.ctx.strokeStyle}=s;this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(n,o),this.ctx.strokeStyle=i,this.ctx.stroke()},drawPolygon:function(t,e={}){let{color:n,lineColor:o=this.ctx.strokeStyle,radius:s=0,close:i=!1}=e;function a(t,e,n,o,s,i){let a=Math.sqrt((n-t)**2+(o-e)**2),r=i?s/a:(a-s)/a;return[t+r*(n-t),e+r*(o-e)]}s>0&&(t=function(t,e){let n=t.length,o=new Array(n);for(let s=0;s<n;s++){let i=s-1,r=s+1;i<0&&(i=n-1),r==n&&(r=0);let l=t[i],c=t[s],u=t[r],d=a(l[0],l[1],c[0],c[1],e,!1),h=a(c[0],c[1],u[0],u[1],e,!0);o[s]=[d[0],d[1],c[0],c[1],h[0],h[1]]}return o}(t,s));let r,l,c=t.length;for(r=0;r<c;r++)l=t[r],0==r?(this.ctx.beginPath(),this.ctx.moveTo(l[0],l[1])):this.ctx.lineTo(l[0],l[1]),s>0&&this.ctx.quadraticCurveTo(l[2],l[3],l[4],l[5]);i&&this.ctx.closePath(),this.ctx.strokeStyle=o,this.ctx.stroke(),this.ctx.fillStyle=n,n&&this.ctx.fill()}};let P,T;const M={stroke:1,colors:["rgb(70,113,170)","rgb(137,204,211)","rgb(32,138,170)","rgb(191,96,107)","rgb(145,101,159)","rgb(70,113,170)"]};function S(t,e){(!P||P&&P!==e)&&(T=function(t){console.log("getFunctionContext",t);let e=document.getElementById(t),n=e.getContext("2d"),o=e.height,s=e.width;return n.strokeStyle=M.colors[0],n.lineWidth=M.stroke,{options:M,ctx:n,h:o,w:s,canvasId:t}}(e),P=e),T.ctx.clearRect(0,0,T.w,T.h),T.ctx.beginPath(),((t,e)=>{let{options:n,ctx:o,h:s,w:i}=e,{colors:a}=n,r=new k(o);t=r.mutateData(t,"shrink",300),t=r.mutateData(t,"scale",s/2),t=r.mutateData(t,"split",5).slice(0,4);let l=0;t.forEach((t=>{const e={lineColor:a[l],radius:.015*s},n=[0,s/2];let o=r.getPoints("line",i,n,t.length,t);r.drawPolygon(o.end,e);let c=r.getPoints("line",i,n,t.length,t,{offset:100});r.drawPolygon(c.start,e),l++}))})(t,T)}let I;var C=function(){console.log("unmount visualize"),I&&window.cancelAnimationFrame(I)},R=function(t,e){const n=e.analyser.frequencyBinCount,o=new Uint8Array(n);console.log("mount visualize",t),function n(){document.getElementById(t)&&(I=requestAnimationFrame(n),e.analyser.getByteFrequencyData(o),S(o,t))}()};const A=/^audio\//;class B{unmount(){}}class q extends B{constructor(t){super(),this.el=t}mount(t){console.log("progress control mount");var e=null;const n=()=>{e&&(clearInterval(e),e=null)},o=o=>{n(),this.el.setAttribute("value",t.currentTime),e=setInterval((()=>{this.el.setAttribute("value",t.currentTime)}),1e3*t.playbackRate)},s=e=>{this.el.setAttribute("max",t.duration)},i=t=>{n()};t.addEventListener("durationchange",s),["play","ratechange"].forEach((e=>{t.addEventListener(e,o)})),t.addEventListener("pause",i),this.unmount=()=>{console.log("progress control unmount"),this.el.removeAttribute("max"),this.el.setAttribute("value",0),t.removeEventListener("durationchange",s),["play","ratechange"].forEach((e=>{t.removeEventListener(e,o)})),t.removeEventListener("pause",i)}}}class D extends B{constructor(){super(),this.start=2,this.end=12}mount(t){console.log("loop control mount");var e=null;const n=()=>{e&&(clearInterval(e),e=null)},o=e=>{n(),t.currentTime=this.start,this.timer=setInterval((()=>{t.currentTime>this.end&&(t.currentTime=this.start)}),1e3*t.playbackRate)},s=t=>{n()};["play","ratechange"].forEach((e=>{t.addEventListener(e,o)})),t.addEventListener("pause",s),this.unmount=()=>{console.log("loop control unmount"),["play","ratechange"].forEach((e=>{t.removeEventListener(e,o)})),t.removeEventListener("pause",s)}}}const H={_context:void 0,_analyser:void 0,get context(){return void 0===this._context&&(this._context=new(window.AudioContext||window.webkitAudioContext)),this._context},get analyser(){if(void 0===this._analyser){this._analyser=this.context.createAnalyser(),this._analyser.minDecibels=-90,this._analyser.maxDecibels=-10,this._analyser.smoothingTimeConstant=.85,this._analyser.fftSize=32768;this.context.createMediaElementSource(document.getElementById("audio")).connect(this._analyser)}return this._analyser},connect:function(){this.analyser.connect(this.context.destination)},disconnect:function(){this._analyser&&this.analyser.disconnect(this.context.destination)}};function W(t,e){if(n=e.type,!A.test(n))throw new Error("is not a audio file");var n;return new Promise(((n,o)=>{const s=new FileReader;s.onload=e=>{t.src=e.target.result,n()},s.readAsDataURL(e),s.onerror=t=>o(t)}))}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("audio-data"),e=document.getElementById("audio");document.getElementById("visualizer").setAttribute("width",document.querySelector(".wrapper").clientWidth);const o=new q(document.getElementById("progress-control"));new D,t.addEventListener("change",(t=>{n.unmount(),s.unmount(),a.unmount(),h.unmount(),w.unmount(),o.unmount(),C(),H.disconnect(),W(e,t.target.files[0]).then((()=>{document.title=t.target.files[0].name+" — GB Player",n.mount(e),s.mount(e),a.mount(e),h.mount(e),w.mount(e),o.mount(e),H.connect(),R("visualizer",H)}))}))}))}();
//# sourceMappingURL=index.52aabd1f.js.map
